<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMMS UNIT STUFF!</title>
    <style>
        body {
            background: #181c24;
            color: #f3f3f3;
            font-family: 'Segoe UI', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        h2 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 5.2rem;
        }
        label, select, input {
            font-size: 1.1rem;
        }
        #durationInput, #clockInput {
            margin: 10px 0;
        }
        input[type="number"], input[type="time"] {
            padding: 6px 10px;
            border-radius: 5px;
            border: 1px solid #444;
            background: #23283a;
            color: #f3f3f3;
            margin-right: 5px;
        }
        select {
            padding: 6px 10px;
            border-radius: 5px;
            border: 1px solid #444;
            background: #23283a;
            color: #f3f3f3;
        }
        #startTimer {
            padding: 10px 30px;
            background: #3a7afe;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.2s;
        }
        #startTimer:hover {
            background: #2556b8;
        }
        #timerDisplay {
            font-size: 3rem;
            font-weight: bold;
            margin: 25px 0 0 0;
            letter-spacing: 2px;
            color: #3a7afe;
            text-shadow: 0 2px 8px #000a;
        }
        div {
            margin-bottom: 8px;
        }
        /* Popup styles */
        #timerPopup {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            animation: none;
        }
        #timerPopup.flashing-bg {
            animation: flash-bg 0.7s infinite alternate;
        }
        #popupContent {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .flashing {
            font-size: 8rem;
            color: #ff2222;
            font-weight: bold;
            text-shadow: 0 0 30px #ff2222, 0 0 10px #fff;
        }
        @keyframes flash-bg {
            from { background: #ff2222; }
            to { background: #7a0000; }
        }
        #popupMsg {
            color: #fff;
            font-size: 2rem;
            margin-top: 10px;
            text-align: center;
        }
        #timerPopup {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h2>Multi Timer</h2>
    <form id="newTimerForm" autocomplete="off" style="margin-bottom: 20px;">
        <input type="text" id="timerName" placeholder="Timer name" maxlength="30" style="width: 140px; margin-right: 10px;">
        <select id="timerType">
            <option value="duration">Duration (min:sec)</option>
            <option value="clock">Clock Time (HH:MM)</option>
        </select>
        <span id="durationInput">
            <input type="number" id="minutes" placeholder="Min" min="0" style="width:55px;"> :
            <input type="number" id="seconds" placeholder="Sec" min="0" max="59" style="width:55px;">
        </span>
        <span id="clockInput" style="display:none;">
            <input type="time" id="clockTime">
        </span>
        <button type="submit" id="addTimer">Add Timer</button>
    </form>
    <div id="timersList"></div>
    <!-- Flashing popup for timer end -->
    <div id="timerPopup">
        <div id="popupContent">
            <span class="flashing">!</span>
            <div id="popupMsg">Time is up!<br><span style="font-size:1.1rem;">(Click anywhere to close)</span></div>
        </div>
    </div>
    <script>
        // Multi-timer logic
        const timerType = document.getElementById('timerType');
        const durationInput = document.getElementById('durationInput');
        const clockInput = document.getElementById('clockInput');
        const timersList = document.getElementById('timersList');
        const timerPopup = document.getElementById('timerPopup');
        const popupMsg = document.getElementById('popupMsg');
        const newTimerForm = document.getElementById('newTimerForm');
        const timerNameInput = document.getElementById('timerName');
        let timers = [];
        let popupTimerName = '';

        function pad(n) {
            return n.toString().padStart(2, '0');
        }

        let lastFinishedTimerIdx = null;
        function showTimerPopup(name, idx) {
            popupMsg.innerHTML = `<b>${name}</b><br>Time is up!<br><span style=\"font-size:1.1rem;\">(Click anywhere to close)</span>`;
            timerPopup.classList.add('flashing-bg');
            timerPopup.style.display = 'flex';
            lastFinishedTimerIdx = idx;
        }
        function hideTimerPopupAndRestart() {
            timerPopup.style.display = 'none';
            timerPopup.classList.remove('flashing-bg');
            if (lastFinishedTimerIdx !== null && timers[lastFinishedTimerIdx]) {
                // Reset and restart the timer
                let timer = timers[lastFinishedTimerIdx];
                timer.remaining = timer.total;
                timer.display = pad(Math.floor(timer.remaining/60)) + ':' + pad(timer.remaining%60);
                timer.running = false;
                timer.started = false;
                renderTimers();
                toggleTimer(lastFinishedTimerIdx);
            }
            lastFinishedTimerIdx = null;
        }
        timerPopup && timerPopup.addEventListener('click', hideTimerPopupAndRestart);

        timerType.addEventListener('change', function() {
            if (this.value === 'duration') {
                durationInput.style.display = '';
                clockInput.style.display = 'none';
            } else {
                durationInput.style.display = 'none';
                clockInput.style.display = '';
            }
        });

        function renderTimers() {
            timersList.innerHTML = '';
            timers.forEach((timer, idx) => {
                const div = document.createElement('div');
                div.style.background = '#23283a';
                div.style.borderRadius = '8px';
                div.style.padding = '12px 18px';
                div.style.margin = '10px 0';
                div.style.display = 'flex';
                div.style.alignItems = 'center';
                div.style.gap = '18px';
                div.style.boxShadow = '0 2px 8px #0004';

                const name = document.createElement('span');
                name.textContent = timer.name || 'Timer';
                name.style.fontWeight = 'bold';
                name.style.fontSize = '1.2rem';
                name.style.minWidth = '90px';

                const time = document.createElement('span');
                time.textContent = timer.display;
                time.style.fontFamily = 'monospace';
                time.style.fontSize = '2rem';
                time.style.letterSpacing = '2px';
                time.id = `timerDisplay${idx}`;

                const startBtn = document.createElement('button');
                startBtn.textContent = timer.running ? 'Pause' : (timer.started ? 'Resume' : 'Start');
                startBtn.style.marginLeft = '10px';
                startBtn.style.padding = '6px 18px';
                startBtn.style.background = timer.running ? '#ffb13a' : '#3a7afe';
                startBtn.style.color = '#fff';
                startBtn.style.border = 'none';
                startBtn.style.borderRadius = '5px';
                startBtn.style.cursor = 'pointer';
                startBtn.onclick = () => toggleTimer(idx);

                const removeBtn = document.createElement('button');
                removeBtn.textContent = 'Remove';
                removeBtn.style.marginLeft = '10px';
                removeBtn.style.padding = '6px 12px';
                removeBtn.style.background = '#d32f2f';
                removeBtn.style.color = '#fff';
                removeBtn.style.border = 'none';
                removeBtn.style.borderRadius = '5px';
                removeBtn.style.cursor = 'pointer';
                removeBtn.onclick = () => removeTimer(idx);

                div.appendChild(name);
                div.appendChild(time);
                div.appendChild(startBtn);
                div.appendChild(removeBtn);
                timersList.appendChild(div);
            });
        }

        function updateTimerDisplays() {
            timers.forEach((timer, idx) => {
                const el = document.getElementById(`timerDisplay${idx}`);
                if (el) el.textContent = timer.display;
            });
        }

        function removeTimer(idx) {
            if (timers[idx].interval) clearInterval(timers[idx].interval);
            timers.splice(idx, 1);
            renderTimers();
        }

        function toggleTimer(idx) {
            const timer = timers[idx];
            if (timer.running) {
                clearInterval(timer.interval);
                timer.running = false;
            } else {
                if (!timer.started) timer.remaining = timer.total;
                timer.started = true;
                timer.running = true;
                timer.interval = setInterval(() => {
                    timer.remaining--;
                    timer.display = pad(Math.floor(timer.remaining/60)) + ':' + pad(timer.remaining%60);
                    updateTimerDisplays();
                    if (timer.remaining <= 0) {
                        clearInterval(timer.interval);
                        timer.display = '00:00';
                        timer.running = false;
                        showTimerPopup(timer.name || 'Timer', idx);
                        updateTimerDisplays();
                    }
                }, 1000);
            }
            renderTimers();
        }

        newTimerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            let totalSeconds;
            let name = timerNameInput.value.trim() || 'Timer';
            if (timerType.value === 'duration') {
                const min = parseInt(document.getElementById('minutes').value) || 0;
                const sec = parseInt(document.getElementById('seconds').value) || 0;
                totalSeconds = min * 60 + sec;
            } else {
                const now = new Date();
                const [h, m] = document.getElementById('clockTime').value.split(':') || [0,0];
                const target = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0);
                if (target < now) target.setDate(target.getDate() + 1);
                totalSeconds = Math.floor((target - now) / 1000);
            }
            if (isNaN(totalSeconds) || totalSeconds <= 0) {
                alert('Please enter a valid time.');
                return;
            }
            timers.push({
                name,
                total: totalSeconds,
                remaining: totalSeconds,
                display: pad(Math.floor(totalSeconds/60)) + ':' + pad(totalSeconds%60),
                running: false,
                started: false,
                interval: null
            });
            renderTimers();
            // Automatically start the new timer
            toggleTimer(timers.length - 1);
            timerNameInput.value = '';
            document.getElementById('minutes').value = '';
            document.getElementById('seconds').value = '';
            document.getElementById('clockTime').value = '';
        });

        // Initial render
        renderTimers();
    </script>
</body>
</html>